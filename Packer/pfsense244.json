{
    "builders": [
      {
      "type": "vmware-iso",
        "boot_command": [
            "<enter><wait10>",
            "<enter><wait10>",
            "<enter><wait10>",
            "<enter><wait10>",
            "<enter><wait1m>",
            "<enter><wait10>",
            "<enter><wait10>",
            "<enter><wait2m>",
            "14<enter><wait10>",
            "y<enter><wait10>",
            "8<enter><wait10>",
            "pkg install -y bash<enter><wait5>",
            "pkg install -y sudo<enter><wait5>",
            "echo vagrant | pw user add vagrant -m -s /usr/local/bin/bash -b /home/ -G wheel -h 0<enter><wait>",
            "chmod 660 /usr/local/etc/sudoers<enter><wait>",
            "echo 'vagrant ALL=(ALL) NOPASSWD: ALL' >> /usr/local/etc/sudoers &&  echo '%wheel ALL=(ALL) NOPASSWD: ALL' >> /usr/local/etc/sudoers<enter><wait>",
            "chmod 440 /usr/local/etc/sudoers && chflags schg /usr/local/etc/sudoers<enter><wait>",
            "[ ! -d /home/vagrant/.ssh ] && mkdir -p /home/vagrant/.ssh<enter><wait>",
	          "chmod 0700 /home/vagrant/.ssh<enter><wait>",
            "curl -sfSL {{ .HTTPIP }}:{{ .HTTPPort }}/vagrant-authorized_keys -o /home/vagrant/.ssh/authorized_keys<enter><wait>",
	          "chown -R vagrant /home/vagrant/.ssh<enter><wait>",
	          "chmod 0600 /home/vagrant/.ssh/authorized_keys<enter><wait>",
            "cp /conf/config.xml /conf/config.xml.orig<enter><wait>",
            "rm -f /conf/trigger_initial_wizard<enter><wait>",
            "curl -sfSL {{ .HTTPIP }}:{{ .HTTPPort }}/config-pfsense_244.xml -o /conf/config.xml<enter><wait>",
            "pfctl -d<enter><wait>",
            "exit<enter>"
        ],
      "boot_wait": "1m30s",
      "vm_name": "packer-pfsense-2.4.4-amd64",
      "iso_urls": [
          "isos/pfSense-CE-2.4.4-RELEASE-amd64.iso"
      ],
      "iso_checksum_type": "{{user `iso_checksum_type`}}",
      "iso_checksum": "{{user `iso_checksum`}}",
      "headless": false,
      "ssh_username": "{{user `ssh_username`}}",
      "ssh_password": "{{user `ssh_password`}}",
      "ssh_wait_timeout": "10000s",
      "shutdown_timeout": "2h",
      "shutdown_command": "sudo shutdown now",
      "http_directory": "{{user `http_directory`}}",
      "http_port_min": "8100",
      "http_port_max": "9000",
      "guest_os_type": "freebsd-64",
      "disk_size": "{{user `disk_size`}}",
      "vnc_port_min": 5900,
      "vnc_port_max": 5980,
      "vnc_disable_password": true,
      "remote_type": "esx5",
      "remote_host": "{{user `esxi_host`}}",
      "remote_datastore": "{{user `esxi_datastore`}}",
      "remote_username": "{{user `esxi_username`}}",
      "remote_password": "{{user `esxi_password`}}",
      "keep_registered": true,
      "vmx_data": {
        "RemoteDisplay.vnc.enabled": "false",
        "RemoteDisplay.vnc.port": "5900",
        "memsize": "512",
        "numvcpus": "1",
        "scsi0.virtualDev": "lsisas1068",
        "ethernet1.virtualDev": "e1000",
        "ethernet0.networkName": "VM Network",
        "ethernet1.present": true,
        "ethernet1.virtualDev": "e1000",
        "ethernet1.networkName": "Internal Network"
      }
    },
    {
      "type": "virtualbox-iso",
      "boot_command": [
          "<enter><wait5>",
          "<enter><wait5>",
          "<enter><wait5>",
          "<enter><wait5>",
          "<enter><wait30>",
          "<enter><wait5>",
          "<enter><wait5>",
          "<enter><wait1m>",
          "14<enter><wait5>",
          "y<enter><wait5>",
          "8<enter><wait5>",
          "pkg install -y bash<enter><wait5>",
          "pkg install -y sudo<enter><wait5>",
          "echo vagrant | pw user add vagrant -m -s /usr/local/bin/bash -b /home/ -G wheel -h 0<enter><wait>",
          "chmod 660 /usr/local/etc/sudoers<enter><wait>",
          "echo 'vagrant ALL=(ALL) NOPASSWD: ALL' >> /usr/local/etc/sudoers &&  echo '%wheel ALL=(ALL) NOPASSWD: ALL' >> /usr/local/etc/sudoers<enter><wait>",
          "chmod 440 /usr/local/etc/sudoers && chflags schg /usr/local/etc/sudoers<enter><wait>",
          "[ ! -d /home/vagrant/.ssh ] && mkdir -p /home/vagrant/.ssh<enter><wait>",
	        "chmod 0700 /home/vagrant/.ssh<enter><wait>",
          "curl -sfSL {{ .HTTPIP }}:{{ .HTTPPort }}/vagrant-authorized_keys -o /home/vagrant/.ssh/authorized_keys<enter><wait>",
          "chown -R vagrant /home/vagrant/.ssh<enter><wait>",
          "chmod 0600 /home/vagrant/.ssh/authorized_keys<enter><wait>",
          "cp /conf/config.xml /conf/config.xml.orig<enter><wait>",
          "rm -f /conf/trigger_initial_wizard<enter><wait>",
          "curl -sfSL {{ .HTTPIP }}:{{ .HTTPPort }}/config-pfsense_244.xml -o /conf/config.xml<enter><wait>",
          "pfctl -d<enter><wait>",
          "exit<enter>"
      ],
      "boot_wait": "45s",
      "vm_name": "packer-pfsense-2.4.4-amd64",
      "iso_urls": [
          "isos/pfSense-CE-2.4.4-RELEASE-amd64.iso"
      ],
      "iso_checksum_type": "{{user `iso_checksum_type`}}",
      "iso_checksum": "{{user `iso_checksum`}}",
      "ssh_username": "{{user `ssh_username`}}",
      "ssh_password": "{{user `ssh_password`}}",
      "ssh_wait_timeout": "10000s",
      "shutdown_timeout": "2h",
      "shutdown_command": "sudo shutdown now",
      "http_directory": "{{user `http_directory`}}",
      "http_port_min": "8100",
      "http_port_max": "9000",
      "guest_os_type": "FreeBSD_64",
      "disk_size": "{{user `disk_size`}}",
      "headless": true,
      "guest_additions_path": "VBoxGuestAdditions_{{.Version}}.iso",
      "virtualbox_version_file": ".vbox_version",
      "vboxmanage": [
        [ "modifyvm", "{{.Name}}", "--memory",           "512"                 ],
        [ "modifyvm", "{{.Name}}", "--cpus",             "1"                   ],
        [ "modifyvm", "{{.Name}}", "--nic1",             "nat"                 ],
        [ "modifyvm", "{{.Name}}", "--cableconnected1",  "on"                  ],
        [ "modifyvm", "{{.Name}}", "--nic2",             "intnet"              ],
        [ "modifyvm", "{{.Name}}", "--nicpromisc2",      "allow-all"           ],
        [ "modifyvm", "{{.Name}}", "--nictype2", 	       "82540EM"             ],
        [ "modifyvm", "{{.Name}}", "--cableconnected2",  "on"                  ]
      ]
    }
    ],
    "post-processors": [{
      "type": "vagrant",
      "keep_input_artifact": false,
      "compression_level": "8",
      "output": "../Boxes/pfsense_244_{{.Provider}}.box",
      "vagrantfile_template": "vagrantfile-pfsense_244.template"
    }],
    "variables": {
    "iso_checksum_type": "md5",
    "iso_checksum": "71386433238f96fc167d14cec9c708c6",
    "disk_size": "20000",
    "ssh_username": "vagrant",
    "ssh_password": "vagrant",
    "http_directory": "./scripts",
    "esxi_host": "192.168.202.140",
    "esxi_datastore": "datastore1",
    "esxi_username": "root",
    "esxi_password": "r00tr00t123#"
    }
}
